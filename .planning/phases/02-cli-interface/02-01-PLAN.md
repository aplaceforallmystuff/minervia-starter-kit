---
phase: 02-cli-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [install.sh]
autonomous: true

must_haves:
  truths:
    - "User can run install.sh --help and see usage information"
    - "User can run install.sh --version and see version number"
    - "Unknown flags produce error message with usage hint"
    - "--help and --version work even without prerequisites met"
  artifacts:
    - path: "install.sh"
      provides: "VERSION constant, show_help, show_version, parse_args"
      contains: "readonly VERSION"
  key_links:
    - from: "parse_args function"
      to: "show_help and show_version"
      via: "case statement branches"
      pattern: "case.*--help\\)"
---

<objective>
Add CLI argument parsing with --help and --version support to install.sh.

Purpose: Users expect standard CLI conventions. --help should show usage, flags, examples, and uninstall instructions. --version should show the current version number. These flags must work immediately, before any prerequisite checks run.

Output: install.sh responds to --help and --version flags following GNU conventions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-cli-interface/02-RESEARCH.md
@install.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add VERSION constant and help/version functions</name>
  <files>install.sh</files>
  <action>
Add these elements to install.sh after the color definitions (after line 15), before the TEMP_FILES array:

1. **VERSION constant** (single source of truth):
```bash
# Version - single source of truth
readonly VERSION="1.0.0"
```

2. **show_help function** using heredoc:
```bash
# Display help message
show_help() {
    cat << 'EOF'
Usage: install.sh [OPTIONS]

Minervia installer - sets up your Obsidian vault for AI-assisted knowledge work.

Options:
  -h, --help      Show this help message and exit
  -V, --version   Show version number and exit

Examples:
  ./install.sh              Run the installer
  ./install.sh --help       Show this help

Prerequisites:
  - Claude Code CLI (https://claude.ai/download)
  - Bash 4.0 or later
  - Write permissions to current directory

Uninstall:
  To remove Minervia from your system:
  1. Delete skill directories: rm -rf ~/.claude/skills/minervia-*
  2. Optionally remove vault files:
     - CLAUDE.md (contains your customizations)
     - .minervia-initialized
     - .minervia-first-run
     - .claude/settings.json (if you want to remove hooks)

More info: https://github.com/aplaceforallmystuff/minervia-starter-kit
EOF
}
```

3. **show_version function**:
```bash
# Display version
show_version() {
    echo "minervia-installer $VERSION"
}
```

These functions go BEFORE the TEMP_FILES array declaration. They're passive definitions that don't execute until called.
  </action>
  <verify>Run `grep -n "readonly VERSION\|show_help\|show_version" install.sh` to confirm all three elements exist</verify>
  <done>VERSION constant defined, show_help function includes usage/flags/examples/prerequisites/uninstall, show_version outputs version</done>
</task>

<task type="auto">
  <name>Task 2: Add argument parsing and wire it up</name>
  <files>install.sh</files>
  <action>
Add argument parsing using while/case/shift pattern. This must run BEFORE any output or prerequisite checks.

1. **Add parse_args function** after show_version, before TEMP_FILES:
```bash
# Parse command-line arguments
# Runs BEFORE any other checks to allow --help/--version without prerequisites
parse_args() {
    while [[ $# -gt 0 ]]; do
        case "$1" in
            -h|--help)
                show_help
                exit 0
                ;;
            -V|--version)
                show_version
                exit 0
                ;;
            --)
                shift
                break
                ;;
            -*)
                echo "Unknown option: $1" >&2
                echo "Run '$(basename "$0") --help' for usage" >&2
                exit 2
                ;;
            *)
                # Non-option argument, stop parsing
                break
                ;;
        esac
        shift
    done
}
```

2. **Call parse_args immediately after function definitions**, before the TEMP_FILES array:
```bash
# Parse arguments first (--help/--version work without prerequisites)
parse_args "$@"
```

Key points:
- Use exit code 2 for invalid usage (not 1 which is for errors)
- The -V (capital V) is used for version, not -v (reserved for verbose)
- Unknown options (-*) show error and exit
- Non-options break the loop (for future positional arguments)
- This runs BEFORE the "Minervia Setup" banner, so --help doesn't show partial output
  </action>
  <verify>Run `./install.sh --help` and verify help text appears. Run `./install.sh --version` and verify version appears. Run `./install.sh --invalid` and verify exit code is 2 (`echo $?`)</verify>
  <done>--help shows usage/flags/examples/uninstall (exit 0), --version shows version (exit 0), unknown flags show error with hint (exit 2)</done>
</task>

</tasks>

<verification>
1. `./install.sh --help` - Shows full help text, exits 0
2. `./install.sh -h` - Shows full help text, exits 0
3. `./install.sh --version` - Shows "minervia-installer 1.0.0", exits 0
4. `./install.sh -V` - Shows "minervia-installer 1.0.0", exits 0
5. `./install.sh --invalid` - Shows error + usage hint, exits 2
6. `./install.sh -x` - Shows error + usage hint, exits 2
7. Help text includes "Uninstall:" section with removal instructions
</verification>

<success_criteria>
- VERSION constant exists as single source of truth
- --help shows usage, options, examples, prerequisites, and uninstall instructions
- --version shows version string
- Unknown flags produce informative error with exit code 2
- Help/version work without any other output (no banner before them)
</success_criteria>

<output>
After completion, create `.planning/phases/02-cli-interface/02-01-SUMMARY.md`
</output>
